<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Using Avaya 1100 Series IP phones with FreePBX" /><meta name="author" content="Clarence M." /><meta property="og:locale" content="en_US" /><meta name="description" content="This post describes how to use Avaya 1100 Series IP phones with FreePBX." /><meta property="og:description" content="This post describes how to use Avaya 1100 Series IP phones with FreePBX." /><link rel="canonical" href="https://cm0.dev/2022/01/06/avaya-1100-series-freepbx" /><meta property="og:url" content="https://cm0.dev/2022/01/06/avaya-1100-series-freepbx" /><meta property="og:site_name" content="Clarence M." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-06T00:00:00+00:00" /> <script type="application/ld+json"> {"url":"https://cm0.dev/2022/01/06/avaya-1100-series-freepbx","author":{"@type":"Person","name":"Clarence M."},"description":"This post describes how to use Avaya 1100 Series IP phones with FreePBX.","headline":"Using Avaya 1100 Series IP phones with FreePBX","dateModified":"2022-01-06T00:00:00+00:00","datePublished":"2022-01-06T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://cm0.dev/2022/01/06/avaya-1100-series-freepbx"},"@context":"https://schema.org"}</script><title> Using Avaya 1100 Series IP phones with FreePBX - Clarence M.</title><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" title="Clarence M." href="/atom.xml"><link rel="alternate" type="application/json" title="Clarence M." href="https://cm0.dev/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><link rel="stylesheet" href="/assets/css/styles.css"><link rel="preconnect" href="//fonts.gstatic.com"><link href="//fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-FRJ10EYV1N"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-FRJ10EYV1N'); </script></head><body><main role="main"><section class="post"> <script src="/assets/js/vanilla-back-to-top.min.js"></script> <script>addBackToTop({ id: 'back-to-top', diameter: 50, })</script><div class="flex-row-between"> <a href="https://cm0.dev/">« back</a> <button id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><div id="page-header"> <time datetime="2022-01-06T00:00:00+00:00">Jan 6, 2022 - </time> <span class="reading-time" title="Estimated read time"> 9 mins read </span><h1 class="title"> Using Avaya 1100 Series IP phones with FreePBX</h1><br> <a href="/tag/voip">voip</a>, <a href="/tag/freepbx">freepbx</a>, <a href="/tag/asterisk">asterisk</a>, <a href="/tag/ip">ip</a>, <a href="/tag/phones">phones</a>, <a href="/tag/nortel">nortel</a>, <a href="/tag/avaya">avaya</a>, <a href="/tag/1100">1100</a>, <a href="/tag/1120e">1120e</a>, <a href="/tag/1140e">1140e</a>, <a href="/tag/series">series</a></div><ul id="toc" class="section-nav"><li class="toc-entry toc-h1"><a href="#prerequisites">Prerequisites</a></li><li class="toc-entry toc-h1"><a href="#converting-phones-from-unistim-to-sip">Converting Phones from UNISTIM to SIP</a><ul><li class="toc-entry toc-h2"><a href="#error-authentication-failed">Error: Authentication Failed</a></li></ul></li><li class="toc-entry toc-h1"><a href="#setting-up-freepbxasterisk">Setting up FreePBX/Asterisk</a></li><li class="toc-entry toc-h1"><a href="#creating-provisoning-files">Creating Provisoning Files</a></li><li class="toc-entry toc-h1"><a href="#configuring-other-phone-features">Configuring other Phone Features.</a><ul><li class="toc-entry toc-h2"><a href="#configuring-intercompaging-features">Configuring Intercom/Paging Features</a></li><li class="toc-entry toc-h2"><a href="#resetting-the-phone">Resetting the Phone</a></li></ul></li></ul><p>I had a few Avaya/Nortel 1120e/1140e IP phones laying around at home and decided to create a house phone and intercom system. Setting these phones up with FreePBX/Astericks was a chore and after many hours of trial and error and google searching, i’ve managed to get these working pretty well with FreePBX.</p><h1 id="prerequisites"> <a class="anchor" href="#prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisites <a href="#prerequisites">#</a></h1><hr><ul><li>Advanced technical knowledge. This guide is not intended for beginners.</li><li>A working FreePBX/Asterisks server.</li><li>A TFTP server.</li><li>(Optional) A configurable DHCP server.</li></ul><h1 id="converting-phones-from-unistim-to-sip"> <a class="anchor" href="#converting-phones-from-unistim-to-sip" aria-hidden="true"><span class="octicon octicon-link"></span></a>Converting Phones from UNISTIM to SIP <a href="#converting-phones-from-unistim-to-sip">#</a></h1><hr><p>If you have one of these phones, there is a good chance that it is running the old UNISTIM firmware. You will need to flash the SIP firmware to the phone in order to get it to work with FreePBX.</p><p>In order to do this easily, a TFTP server should be used. <a href="https://pjo2.github.io/tftpd64/">TFTPD64</a> is an example of one to use. Then configure your DHCP server to include the TFTP’s server IP address in DHCP option 66. If your DHCP server does not allow you to do this, then use TFTPD64’s built in DHCP server.</p><p>Next download the latest firmware for your phone’s model. The latest versions are always available on <a href="https://support.avaya.com/products/P0599/1100-series-ip-deskphones/">Avaya’s website</a>. Place the downloaded <code class="highlighter-rouge">.bin</code> file in the TFTP server’s root directory.</p><p>In the TFTP’s root directory, you will then need to create the following files depending on your phone model.</p><ul><li><code class="highlighter-rouge">1120e.cfg</code></li><li><code class="highlighter-rouge">1120eSIP.cfg</code></li><li><code class="highlighter-rouge">1140e.cfg</code></li><li><code class="highlighter-rouge">1140eSIP.cfg</code></li></ul><p>It is important that they are named according to your phone’s model as shown as above. The phone will be looking for these files as soon as it connects to the TFTP server.</p><p>In each <code class="highlighter-rouge">.cfg</code> file above, include the following contents at the top:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[FW]
DOWNLOAD_MODE FORCED
VERSION &lt;firmware file name&gt;
FILENAME &lt;firmware file name&gt;
PROTOCOL TFTP
SERVER_IP &lt;tftp server ip&gt;
SECURITY_MODE 0
</code></pre></div></div><ul><li>Replace <code class="highlighter-rouge">&lt;firmware file name&gt;</code> with the file name of the firmware you downloaded from Avaya. Ensure that the firmware file is correct for the model you are upgrading.</li><li>Replace <code class="highlighter-rouge">&lt;tftp server ip&gt;</code> with the IP address of your TFTP server.</li></ul><p>Now power up the phone whilst connected to the network and the phone should begin to upgrade its firmware. When the phone powers up, it will obtain the TFTP server automatically from the DHCP server. Then the following will happen:</p><ol><li>Read the appropriate firmware file for the phone’s model. For example, a 1120e on the UNISTIM firmware will read the <code class="highlighter-rouge">1120e.cfg</code> file or a 1120e on the SIP firmware will read the <code class="highlighter-rouge">1120eSIP.cfg</code> file.</li><li>The phone then downloads the firmware file specified in the configuration file.</li><li>The phone will write the firmware to its memory and reboot.</li><li>If the phone was previously on the UNISTIM firmware and now on the SIP firmware, it will now read configuration files ending in SIP.</li></ol><h2 id="error-authentication-failed"> <a class="anchor" href="#error-authentication-failed" aria-hidden="true"><span class="octicon octicon-link"></span></a>Error: Authentication Failed <a href="#error-authentication-failed">#</a></h2><p>If you receive an error <code class="highlighter-rouge">[FW] Authentication Failed</code> this usually means that you are upgrading the firmware of the phone that is too far ahead. In this case you will need to incrementally upgrade the phone up until the latest the version.</p><p>You may also try using the phone’s BootC mode which is essentialy its recovery mode. I’ve found that you can usually bypass this error using this mode. When the phone immediately powers on, hold the Up + 2 key until you see <code class="highlighter-rouge">Starting DHCP...</code> and it will contact the TFTP server to grab the firmware files.</p><p>If in BootC mode, the phone continues to boot normally after <code class="highlighter-rouge">Starting DHCP...</code> is shown, you will need to manually input the TFTP server. Again hold Up + 2 but as soon as the phone’s lights turn off, immediately press the four soft keys below the screen, from left to right in quick succession. If done correctly, you should see a manual configuration prompt. This mode will allow you to input your TFTP’s server IP address. Use the phone’s buttons to navigate through this menu. After you have applied the settings, the phone should reboot and upgrade the firmware.</p><h1 id="setting-up-freepbxasterisk"> <a class="anchor" href="#setting-up-freepbxasterisk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up FreePBX/Asterisk <a href="#setting-up-freepbxasterisk">#</a></h1><hr><p>Once you have upgraded the firmware to SIP, you can now configure FreePBX. In the FreePBX GUI, create a <strong>CHAN_SIP</strong> extension. It is important that it is on CHAN_SIP as using CHAN_PJSIP will cause the phones to loose SIP registration to the PBX after some time. Take note that when using CHAN_SIP extensions, the SIP port will be 5160/udp instead of the standard 5060/udp port.</p><h1 id="creating-provisoning-files"> <a class="anchor" href="#creating-provisoning-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating Provisoning Files <a href="#creating-provisoning-files">#</a></h1><hr><p>We will now create provisoning files for the phones so that they can connect to the FreePBX server. This can also be done manually by inputting the SIP domain and authentication credentials manually on the phone itself.</p><p>Using the same TFTP server, open your device’s model configuration file. So if you have a 1120e phone, open the <code class="highlighter-rouge">1120eSIP.cfg</code> file. Below the <code class="highlighter-rouge">[FW]</code> section, add the following section below it:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[DEVICE_CONFIG]
DOWNLOAD_MODE FORCED
FILENAME device.cfg
VERSION 000001
PROTOCOL TFTP

[USER_CONFIG]
DOWNLOAD_MODE FORCED
VERSION 000001
PROTOCOL TFTP
</code></pre></div></div><p>Ensure that <code class="highlighter-rouge">[DEVICE_CONFIG]</code> is followed by <code class="highlighter-rouge">[USER_CONFIG]</code> as the phone reads these files from top to bottom and will overwrite settings if the sections are out of order.</p><p>Next create a <code class="highlighter-rouge">device.cfg</code> file in the same directory on the TFTP server. In that file, put the following contents:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DNS_DOMAIN &lt;dns domain&gt;
SIP_DOMAIN1 &lt;sip domain&gt;
SERVER_IP1_1 &lt;sip domain&gt;
SERVER_PORT1_1 5160
SERVER_RETRIES1 3

FORCE_BANNER YES
BANNER THIS IS A BANNER

VMAIL *97
VMAIL_DELAY 300
MAX_APPEARANCE 1
DEF_LANG English
DEF_AUDIO_QUALITY High
LLDP_ENABLE YES
ADMIN_PASSWORD 1234
ADMIN_PASSWORD_EXPIRY 0
DEF_AUDIO_QUALITY High

TIMEZONE_OFFSET &lt;time zone&gt;
FORCE_TIME_ZONE YES

# Disable extended features
MAX_LOGINS 1
USB_HEADSET LOCK
EXP_MODULE_ENABLE NO
ENABLE_SERVICE_PACKAGE NO
IM_MODE DISABLED
AVAYA_AUTOMATIC_QoS NO
VQMON_PUBLISH NO
SIP_TLS_PORT 0
ENABLE_BT NO
</code></pre></div></div><p>Replace…</p><ul><li> <code class="highlighter-rouge">&lt;dns domain&gt;</code> with the DNS domain name of your PBX. This can also be set to the IP address of the PBX server.</li><li> <code class="highlighter-rouge">&lt;sip domain&gt;</code> with the SIP domain name of your PBX. This can also be set to the IP address of the PBX server.</li><li><p><code class="highlighter-rouge">&lt;time zone&gt;</code> with the time zone offset. The offsets are:</p><table><thead><tr><th>Location</th><th>Time zone offset (seconds)</th></tr></thead><tbody><tr><td>(GMT-04:00) Atlantic Standard Time</td><td>-14400</td></tr><tr><td>(GMT-03:30) Newfoundland</td><td>-12600</td></tr><tr><td>(GMT-03:00) Buenos Aires</td><td>-10800</td></tr><tr><td>(GMT-02:30) Newfoundland DST</td><td>-9000</td></tr><tr><td>(GMT-01:00) Azores</td><td>-3600</td></tr><tr><td>(GMT+00:00) Greenwich, Dublin, Lisbon, London</td><td>0</td></tr><tr><td>(GMT+01:00) Central European Time</td><td>3600</td></tr><tr><td>(GMT+02:00) Athens</td><td>7200</td></tr><tr><td>(GMT+03:00) Moscow</td><td>10800</td></tr><tr><td>(GMT+03:30) Tehran</td><td>12600</td></tr><tr><td>(GMT+04:00) Abu Dhabi</td><td>14400</td></tr><tr><td>(GMT+04:30) Khabul</td><td>16200</td></tr><tr><td>(GMT+05:00) Islamabad</td><td>18000</td></tr><tr><td>(GMT+05:30) Indian Standard Time</td><td>19800</td></tr><tr><td>(GMT+06:00) Sri Lanka</td><td>21600</td></tr><tr><td>(GMT+06:30) Myanmar</td><td>23400</td></tr><tr><td>(GMT+07:00) Bangkok</td><td>25200</td></tr><tr><td>(GMT+08:00) China Standard Time</td><td>28800</td></tr><tr><td>(GMT+09:00) Japan Standard Time</td><td>32400</td></tr><tr><td>(GMT+09:30) Australian Central Standard Time</td><td>34200</td></tr><tr><td>(GMT+10:00) Australian Eastern Standard Time</td><td>36000</td></tr><tr><td>(GMT+11:00) Micronesia</td><td>39600</td></tr><tr><td>(GMT+12:00) Fiji</td><td>43200</td></tr><tr><td>(GMT+13:00) New Zealand</td><td>46800</td></tr></tbody></table></li></ul><p>If you do not have a license for these phones, ensure that everything below <em>Disable extended features</em> is included, otherwise you will not be able to login to the phone.</p><p>Now you will need to get the MAC address of the phone. This can be found at the back of the phone. Once you have the MAC address, create a file called <code class="highlighter-rouge">SIP&lt;MAC&gt;.cfg</code> replacing <code class="highlighter-rouge">&lt;MAC&gt;</code> with the phone’s MAC address. In that file, put the following contents:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTOLOGIN_ENABLE USE_AUTOLOGIN_ID
AUTOLOGIN_ID_KEY01 &lt;sip username&gt;@&lt;sip domain&gt;
AUTOLOGIN_AUTHID_KEY01 &lt;sip username&gt;
AUTOLOGIN_PASSWD_KEY01 &lt;sip password&gt;
</code></pre></div></div><p>Replace…</p><ul><li> <code class="highlighter-rouge">&lt;sip username&gt;</code> with the SIP username of your desired extension.</li><li> <code class="highlighter-rouge">&lt;sip domain&gt;</code> with the SIP domain name of your PBX that you configured in <code class="highlighter-rouge">device.cfg</code></li><li> <code class="highlighter-rouge">&lt;sip password&gt;</code> with the SIP password of your desired extension.</li></ul><p>Once you are done, reboot the phone and it should grab the configuration files from the TFTP server and connect to your FreePBX server.</p><h1 id="configuring-other-phone-features"> <a class="anchor" href="#configuring-other-phone-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring other Phone Features. <a href="#configuring-other-phone-features">#</a></h1><hr><p>There are a lot of paramters that can be configured. Refer to the <a href="/assets/files/18125156.pdf">SIP Administration Guide</a> from Avaya for more information.</p><h2 id="configuring-intercompaging-features"> <a class="anchor" href="#configuring-intercompaging-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Intercom/Paging Features <a href="#configuring-intercompaging-features">#</a></h2><p>To get intercom/paging working on FreePBX, you will need to set <code class="highlighter-rouge">ENABLE_ANSWER_MODE</code> to YES in the device.cfg file. Unfortunately, enabling this will require a license for the phone. If you do not have a license and you enable this, you will be locked out of the phone until it is disabled and reset. After you have enabled this, go into the phone’s preferences (press more soft key until you see <em>prefs</em>) -&gt; Feature Options -&gt; Answer Mode Settings and set <em>Allow Mode</em> to public and in <em>Allow Addresses</em> input the SIP addresses to allow intercom/paging from.</p><p>Then on FreePBX ssh into it and edit <code class="highlighter-rouge">/etc/asterisk/extensions_override_freepbx.conf</code> with the following:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[autoanswer]
include =&gt; autoanswer-custom
exten =&gt; s,1,GosubIf($["${ARG1}" != ""]?func-set-sipheader,s,1(Alert-Info,${ARG1}))
exten =&gt; s,n,GosubIf($["${ARG2}" != ""]?func-set-sipheader,s,1(Call-Info,${ARG2}))
exten =&gt; s,n,Gosub(func-set-sipheader,s,1(Answer-Mode,Auto))
exten =&gt; s,n,Gosub(func-apply-sipheaders,s,1())
exten =&gt; s,n,Return()
</code></pre></div></div><p>What this is doing is adding an additional SIP header to the SIP INVITE packet so that the phone will automatically answer the call. This header is the <code class="highlighter-rouge">Answer-Mode</code> header. More information about this can be found from <a href="https://datatracker.ietf.org/doc/html/rfc5373#section-4.3.3">RFC 5373</a></p><h2 id="resetting-the-phone"> <a class="anchor" href="#resetting-the-phone" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resetting the Phone <a href="#resetting-the-phone">#</a></h2><p>To reset the phone you will need to know the mac address of the phone. This can be found at the back of the phone. Enter the following key combination to reset the phone:</p><p><code class="highlighter-rouge">**[7][3][6][3][9][MAC][#][#]</code></p><p>If your MAC address has letters, use the corresponding number to represent the letters. For example if you have an A in the MAC address, you will need to use the number 2. If you have a F in the MAC address, you will need to use the number 3 and so on.</p><h2> Comments</h2><hr><div id="giscusContainer"></div><script> let giscusTheme = localStorage.getItem("theme"); let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "mclarence/cm0.dev", "data-repo-id": "R_kgDOHuEPJw", "data-category": "General", "data-category-id": "DIC_kwDOHuEPJ84CQeYP", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": giscusTheme, "data-lang": "en", "crossorigin": "anonymous", "async": "", }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("giscusContainer").appendChild(giscusScript); </script></section></main><script type="text/javascript"> function sendMessage(message) { const iframe = document.querySelector('iframe.giscus-frame'); if (!iframe) return; console.log("test"); iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app'); } function setTheme(theme) { const giscusIframe = document.querySelector('iframe.giscus-frame'); if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); sendMessage({ setConfig: { theme: 'dark', } }); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); sendMessage({ setConfig: { theme: 'light', } }); } const event = new Event('themeChanged'); document.dispatchEvent(event); } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body></html>
